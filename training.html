<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Learn ‚Ä¢ EcoTrack ‚Äî Learning Roadmap</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  .card-dark {
    background: #2d3748;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    border-radius: 0.5rem;
  }
  .locked { filter: grayscale(.8); opacity:.6; }
  .progress-track { background: linear-gradient(90deg,#10b981,#3b82f6); height:8px; border-radius:9999px; }
  .modal-backdrop{ background: rgba(2,6,23,.6); }
  .modal-close-btn {
    font-size: 1.5rem;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s ease-in-out;
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 9999px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #a0aec0;
    background-color: transparent;
  }
  .modal-close-btn:hover {
    background-color: #4a5568;
    color: #ffffff;
  }
  .modal-container { opacity: 0; transition: opacity 0.1s ease-in-out; }
  .modal-open .modal-container { opacity: 1; }
  .certificate {
    background: url('https://placehold.co/800x600/E5E7EB/1F2937?text=Certificate+Background') no-repeat center center;
    background-size: cover;
    font-family: 'Inter', sans-serif;
    padding: 2rem;
    text-align: center;
    border: 8px solid #3B82F6;
    border-radius: 12px;
    background-color: #f1f5f9;
  }
</style>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>
<body class="bg-slate-900 text-white antialiased">

<div class="max-w-4xl mx-auto p-6">
  <header class="flex items-center gap-4 mb-6">
    <div class="w-14 h-14 rounded-full bg-[#10b981] grid place-items-center text-white text-xl font-bold">üìò</div>
    <div>
      <h1 class="text-2xl font-extrabold">Learning Roadmap</h1>
      <p class="text-sm text-slate-400">Watch short videos to master recycling basics ‚Äî quizzes unlock the next lesson. Earn coins based on correct answers.</p>
    </div>
  </header>

  <!-- Summary / Progress -->
  <section class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
    <div class="col-span-2 p-4 rounded-lg card-dark flex items-center justify-between">
      <div>
        <p class="text-sm text-slate-400">Your Coins</p>
        <p id="coins" class="text-2xl font-bold text-amber-400">0</p>
      </div>
      <div style="min-width:220px">
        <p class="text-sm text-slate-400">Progress <span id="percent">0%</span></p>
        <div class="w-full mt-2 h-2 rounded-full bg-slate-700 overflow-hidden">
          <div id="progressBar" class="progress-track" style="width:0%"></div>
        </div>
        <p class="text-xs text-slate-500 mt-1" id="completedText">0 of 5 lessons completed</p>
      </div>
    </div>
    <div class="p-4 rounded-lg card-dark">
      <h3 class="text-sm font-semibold text-slate-300">Continue Learning</h3>
      <p class="text-xs text-slate-400" id="continueLessonText"></p>
      <div class="mt-3">
        <button id="continueBtn" class="w-full inline-flex items-center justify-center gap-2 px-4 py-2 rounded-md bg-[#10b981] text-white font-semibold transition-all hover:scale-[1.01] hover:opacity-90">Start Now ‚ûú</button>
      </div>
    </div>
  </section>

  <!-- Lessons list -->
  <section class="space-y-4">
    <div id="lessons" class="space-y-3"></div>
    <div id="finalQuizCard" class="p-4 card-dark flex items-center justify-between gap-4 transition-all hover:scale-[1.01] hover:opacity-90 duration-200 ease-in-out locked">
      <div class="flex items-center gap-4">
        <div class="w-14 h-14 rounded-full flex items-center justify-center bg-slate-700 text-slate-400 font-bold">‚≠ê</div>
        <div>
          <h4 class="font-semibold">Final Quiz</h4>
          <p class="text-xs text-slate-400">Earn your Digital Certificate</p>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <div class="text-sm text-slate-400">200 coins</div>
        <div>
          <button id="finalQuizBtn" class="px-3 py-1 rounded bg-slate-700 text-slate-500 transition-all hover:scale-[1.01] hover:opacity-90" disabled>üîí</button>
        </div>
      </div>
    </div>
  </section>

  <footer class="mt-8 text-xs text-slate-500 text-center">Tip: Watch video and take quiz to unlock the next lesson. Progress is saved in your browser.</footer>
</div>

<!-- Video Modal -->
<div id="modal" class="fixed inset-0 hidden items-center justify-center z-50">
  <div class="absolute inset-0 modal-backdrop"></div>
  <div class="relative w-full max-w-3xl mx-4 card-dark rounded-lg overflow-hidden modal-container">
    <div class="flex items-center justify-between p-3 border-b border-slate-700">
      <h3 id="modalTitle" class="font-semibold">Lesson</h3>
      <button id="closeModal" class="modal-close-btn">√ó</button>
    </div>
    <div class="p-4 bg-black/90">
      <video id="lessonVideo" controls style="width:100%; height:420px; background:#000">
        <source id="videoSource" src="videos/lesson1.mp4" type="video/mp4">
        Your browser doesn't support HTML5 video.
      </video>
      <button id="takeQuiz" class="mt-3 px-3 py-1 rounded bg-[#10b981] text-white w-full transition-all hover:scale-[1.01] hover:opacity-90">Take Quiz</button>
    </div>
  </div>
</div>

<!-- Quiz Modal -->
<div id="quizModal" class="fixed inset-0 hidden items-center justify-center z-50">
  <div class="absolute inset-0 modal-backdrop"></div>
  <div class="relative w-full max-w-3xl mx-4 card-dark rounded-lg overflow-hidden p-6 modal-container">
    <div class="flex justify-between items-center mb-4">
      <h3 id="quizTitle" class="font-semibold text-lg">Quiz</h3>
      <button id="closeQuiz" class="modal-close-btn">√ó</button>
    </div>
    <div class="flex justify-between items-center mb-2">
      <span id="quizTimer" class="text-sm font-semibold text-red-500">Time Left: 40s</span>
    </div>
    <div id="quizContent" class="space-y-4"></div>
  </div>
</div>

<!-- Custom Alert Modal -->
<div id="alertModal" class="fixed inset-0 hidden items-center justify-center z-50">
  <div class="absolute inset-0 modal-backdrop"></div>
  <div id="alertContent" class="relative card-dark rounded-lg w-80 p-6 text-center modal-container">
    <div id="alertMessage" class="text-slate-300 font-medium mb-4"></div>
    <button id="alertCloseBtn" class="px-4 py-2 bg-[#10b981] text-white rounded-md font-semibold transition-all hover:scale-[1.01] hover:opacity-90">OK</button>
  </div>
</div>

<!-- Certificate Modal -->
<div id="certificateModal" class="fixed inset-0 hidden items-center justify-center z-50">
  <div class="absolute inset-0 modal-backdrop"></div>
  <div id="certificateContainer" class="relative w-full max-w-4xl mx-4 rounded-lg overflow-hidden p-6 certificate modal-container">
    <button id="closeCertificate" class="absolute top-2 right-4 modal-close-btn text-black">√ó</button>
    <div id="certificateContent" class="relative p-12">
      <h2 class="text-4xl font-bold text-emerald-600 mb-2">Certificate of Completion</h2>
      <p class="text-xl font-semibold text-slate-700 mb-8">This certificate is awarded to</p>
      <p id="certificateName" class="text-5xl font-extrabold text-blue-600 mb-8">Eco-Citizen</p>
      <p class="text-xl text-slate-600">for successfully completing the EcoTrack Learning Roadmap and demonstrating a strong understanding of sustainable practices. You have earned the title of Certified Eco-Advocate.</p>
      <p class="text-sm text-slate-500 mt-8">Date: <span id="certificateDate"></span></p>
    </div>
    <button id="downloadCertificateBtn" class="mt-6 px-4 py-2 bg-blue-500 text-white rounded-md font-semibold transition-all hover:scale-[1.01] hover:opacity-90">Download as PNG</button>
  </div>
</div>

<script>
const lessonsData = [
  { id:1, title:'Lesson 1: Introduction', desc:'Why recycling matters', coins:100, videoSrc:'videos/lesson1.mp4', unlocked:true, watched:false },
  { id:2, title:'Lesson 2: Sorting Waste', desc:'How to separate recyclables', coins:100, videoSrc:'videos/lesson2.mp4', unlocked:false, watched:false },
  { id:3, title:'Lesson 3: Composting', desc:'Turn kitchen scraps into soil', coins:100, videoSrc:'videos/lesson3.mp4', unlocked:false, watched:false },
  { id:4, title:'Lesson 4: Reducing Plastic', desc:'Cut single-use plastics', coins:100, videoSrc:'videos/lesson4.mp4', unlocked:false, watched:false },
  { id:5, title:'Lesson 5: Energy Saving', desc:'Small habits to save energy', coins:100, videoSrc:'videos/lesson5.mp4', unlocked:false, watched:false }
];

const quizzes = {
  1: [
    { q:"Why is recycling important?", options:["Saves resources","Wastes time","Costs money","No effect"], answer:0 },
    { q:"Which can be recycled?", options:["Plastic","Glass","Paper","All of the above"], answer:3 },
    { q:"Recycling reduces ...?", options:["Pollution","Income","Sleep","Traffic"], answer:0 },
    { q:"Which color bin is for paper?", options:["Blue","Green","Red","Yellow"], answer:0 },
    { q:"Single-use plastics include?", options:["Bags","Bottles","Straws","All of the above"], answer:3 }
  ],
  2: [
    { q:"First step in sorting?", options:["Separate recyclables","Throw all in trash","Burn","Ignore"], answer:0 },
    { q:"Plastic bottles go in?", options:["Blue bin","Green bin","Red bin","Yellow bin"], answer:0 },
    { q:"Glass bottles go in?", options:["Blue","Green","Red","Yellow"], answer:2 },
    { q:"Food waste can be?", options:["Composted","Landfill only","Burned","Thrown away"], answer:0 },
    { q:"Sorting helps?", options:["Recycle efficiently","Waste money","Nothing","Increase pollution"], answer:0 }
  ],
  // Final quiz
  6: [
    { q:"What is a major benefit of composting?", options:["Reduces landfill waste","Increases trash","Contaminates soil","Creates pollution"], answer:0 },
    { q:"What does the 'Reduce' in 'Reduce, Reuse, Recycle' mean?", options:["Buy less stuff","Throw things away","Recycle more","Burn waste"], answer:0 },
    { q:"Which is the most energy-efficient light bulb?", options:["Incandescent","LED","Fluorescent","Halogen"], answer:1 },
    { q:"How can you reduce water usage at home?", options:["Take shorter showers","Leave the tap running","Wash your car daily","Water the lawn every hour"], answer:0 },
    { q:"What material takes the longest to decompose?", options:["Paper","Glass","Plastic","Food scraps"], answer:2 }
  ]
};

let state = { lessons: lessonsData };
let currentLessonId = null, currentQuizAnswers=[], currentQuestionIndex=0, timerInterval=null;

// Elements
const lessonsEl = document.getElementById('lessons');
const finalQuizCard = document.getElementById('finalQuizCard');
const finalQuizBtn = document.getElementById('finalQuizBtn');
const coinsEl = document.getElementById('coins');
const progressBar = document.getElementById('progressBar');
const percentEl = document.getElementById('percent');
const completedText = document.getElementById('completedText');
const continueBtn = document.getElementById('continueBtn');
const continueLessonText = document.getElementById('continueLessonText');
const modal = document.getElementById('modal');
const lessonVideo = document.getElementById('lessonVideo');
const videoSource = document.getElementById('videoSource');
const closeModal = document.getElementById('closeModal');
const takeQuiz = document.getElementById('takeQuiz');
const quizModal = document.getElementById('quizModal');
const quizContent = document.getElementById('quizContent');
const closeQuiz = document.getElementById('closeQuiz');
const quizTimer = document.getElementById('quizTimer');
const alertModal = document.getElementById('alertModal');
const alertMessage = document.getElementById('alertMessage');
const alertCloseBtn = document.getElementById('alertCloseBtn');
const certificateModal = document.getElementById('certificateModal');
const closeCertificate = document.getElementById('closeCertificate');
const certificateContainer = document.getElementById('certificateContainer');
const certificateDate = document.getElementById('certificateDate');
const downloadCertificateBtn = document.getElementById('downloadCertificateBtn');

// Alert
function showAlert(message) {
  alertMessage.textContent = message;
  alertModal.classList.remove('hidden');
  alertModal.classList.add('flex', 'modal-open');
}
function hideAlert() {
  alertModal.classList.remove('flex', 'modal-open');
  alertModal.classList.add('hidden');
}
alertCloseBtn.addEventListener('click', hideAlert);

// Render lessons
function renderLessons(){
  lessonsEl.innerHTML = '';
  state.lessons.forEach((l,idx)=>{
    const locked = !l.unlocked;
    const li = document.createElement('div');
    li.className = `p-4 card-dark flex items-center justify-between gap-4 transition-all hover:scale-[1.01] hover:opacity-90 duration-200 ease-in-out ${locked?'locked':''}`;
    li.innerHTML = `
      <div class="flex items-center gap-4">
        <div class="w-14 h-14 rounded-full flex items-center justify-center bg-slate-700 text-slate-400 font-bold">${idx+1}</div>
        <div>
          <h4 class="font-semibold">${l.title}</h4>
          <p class="text-xs text-slate-400">${l.desc}</p>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <div class="text-sm text-slate-400">${l.coins} coins</div>
        <div>
          ${locked
            ? `<button class="px-3 py-1 rounded bg-slate-700 text-slate-500" disabled>üîí</button>`
            : `<button data-lesson="${l.id}" class="openBtn px-3 py-1 rounded bg-[#10b981] text-white">Start</button>`}
        </div>
      </div>
    `;
    lessonsEl.appendChild(li);
  });

  const completedCount = state.lessons.filter(x=>x.watched).length;
  const total = state.lessons.length;
  const allLessonsCompleted = completedCount === total;
  
  if(allLessonsCompleted) {
    finalQuizCard.classList.remove('locked');
    finalQuizBtn.classList.remove('bg-slate-700', 'text-slate-500');
    finalQuizBtn.classList.add('bg-blue-500', 'text-white');
    finalQuizBtn.textContent = 'Start';
    finalQuizBtn.disabled = false;
    finalQuizBtn.onclick = () => showQuiz(6);
  }

  const nextLesson = state.lessons.find(x=> x.unlocked && !x.watched) || state.lessons[state.lessons.length-1];
  continueLessonText.textContent = nextLesson.title;
  continueBtn.onclick = ()=> openLesson(nextLesson.id);

  document.querySelectorAll('.openBtn').forEach(b=> b.addEventListener('click', e=> openLesson(Number(e.currentTarget.dataset.lesson))));

  const percent = Math.round((completedCount/total)*100);
  progressBar.style.width = percent+'%';
  percentEl.textContent = percent+'%';
  completedText.textContent = `${completedCount} of ${total} lessons completed`;
  coinsEl.textContent = state.lessons.filter(x=>x.watched).reduce((s,n)=>s+n.coins,0) + (allLessonsCompleted ? 200 : 0);
}

// Lesson modal
function openLesson(id){
  const lesson = state.lessons.find(x=>x.id===id);
  if(!lesson || !lesson.unlocked) return;
  currentLessonId = id;
  modal.classList.remove('hidden'); 
  modal.classList.add('flex', 'modal-open');
  videoSource.src = lesson.videoSrc;
  lessonVideo.load();
}
function closeLessonModal(){ 
  modal.classList.remove('flex', 'modal-open');
  modal.classList.add('hidden');
}
closeModal.addEventListener('click', closeLessonModal);
takeQuiz.addEventListener('click', ()=> showQuiz(currentLessonId));
lessonVideo.addEventListener('ended', ()=> showQuiz(currentLessonId));

// Quiz
function showQuiz(lessonId){
  const questions = quizzes[lessonId];
  if(!questions) return showAlert("No quiz for this lesson");
  currentLessonId = lessonId;
  currentQuizAnswers = new Array(questions.length).fill(null);
  currentQuestionIndex = 0;
  quizModal.classList.remove('hidden'); 
  quizModal.classList.add('flex', 'modal-open');
  startTimer(40);
  showQuestion();
}
function startTimer(seconds){
  let timeLeft = seconds;
  quizTimer.textContent = `Time Left: ${timeLeft}s`;
  if(timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(()=>{
    timeLeft--;
    quizTimer.textContent = `Time Left: ${timeLeft}s`;
    if(timeLeft<=0){
      clearInterval(timerInterval);
      showAlert("Time's up!");
      calculateQuizResult();
    }
  },1000);
}
function showQuestion(){
  const questions = quizzes[currentLessonId];
  const q = questions[currentQuestionIndex];
  quizContent.innerHTML = `
    <p class="font-semibold">${currentQuestionIndex+1}. ${q.q}</p>
    ${q.options.map((opt,i)=>`
      <label class="block ml-4 mt-2 cursor-pointer text-slate-300">
        <input type="radio" name="q${currentQuestionIndex}" value="${i}"> ${opt}
      </label>`).join('')}
    <button id="nextQuestion" class="mt-3 px-4 py-2 rounded bg-[#10b981] text-white">Next</button>
  `;
  document.getElementById('nextQuestion').addEventListener('click', ()=>{
    const selected = document.querySelector(`input[name="q${currentQuestionIndex}"]:checked`);
    if(!selected){ showAlert("Select an answer"); return; }
    currentQuizAnswers[currentQuestionIndex] = Number(selected.value);
    if(currentQuestionIndex+1 < questions.length) currentQuestionIndex++, showQuestion();
    else calculateQuizResult();
  });
}
function calculateQuizResult(){
  clearInterval(timerInterval);
  const questions = quizzes[currentLessonId];
  let correctCount=0;
  questions.forEach((q,i)=>{ if(currentQuizAnswers[i]===q.answer) correctCount++; });
  const scorePercent = Math.round((correctCount/questions.length)*100);

  if (currentLessonId === 6) {
    if (scorePercent >= 80) {
      showCertificate();
      showAlert(`Congratulations! You scored ${scorePercent}% and earned your certificate!`);
    } else {
      showAlert(`You scored ${scorePercent}%. You need at least 80% to earn the certificate. Try again!`);
    }
  } else {
    const lesson = state.lessons.find(x=>x.id===currentLessonId);
    lesson.watched = scorePercent>=50;
    lesson.coins = Math.round((correctCount/questions.length)*lesson.coins);
    const nextIdx = state.lessons.findIndex(x=>x.id===currentLessonId)+1;
    if(state.lessons[nextIdx] && scorePercent>=50) {
      state.lessons[nextIdx].unlocked = true;
      showAlert(`Congratulations! You scored ${scorePercent}% and unlocked the next lesson!`);
    } else {
      showAlert(`You scored ${scorePercent}%. You need at least 50% to pass. Try again!`);
    }
    renderLessons();
  }
  closeQuizModal();
  closeLessonModal();
}
function closeQuizModal(){
  clearInterval(timerInterval);
  quizModal.classList.remove('flex', 'modal-open');
  quizModal.classList.add('hidden');
}
closeQuiz.addEventListener('click', closeQuizModal);

// Certificate
function showCertificate() {
  const today = new Date();
  const dateString = `${today.getDate()}/${today.getMonth() + 1}/${today.getFullYear()}`;
  certificateDate.textContent = dateString;
  certificateModal.classList.remove('hidden');
  certificateModal.classList.add('flex', 'modal-open');
}
function closeCertificateModal() {
  certificateModal.classList.remove('flex', 'modal-open');
  certificateModal.classList.add('hidden');
}
closeCertificate.addEventListener('click', closeCertificateModal);

downloadCertificateBtn.addEventListener('click', () => {
  html2canvas(certificateContainer, { scale: 2 }).then(canvas => {
    const link = document.createElement('a');
    link.href = canvas.toDataURL('image/png');
    link.download = 'Eco-Citizen_Certificate.png';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  });
});

renderLessons();
</script>

</body>
</html>
